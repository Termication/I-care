<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Reviews.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/communitypost.css') }}">
</head>
<body>
    <h1>Welcome, {{ current_user.name }}!</h1>
    
    <h2>Available Doctors</h2>
    <ul>
        {% for doctor in doctors %}
        <li class="doctor-card">
            <strong>Name:</strong> {{ doctor.name }} <br>
            <strong>Specialty:</strong> {{ doctor.specialty }} <br>
            <strong>Contact:</strong> {{ doctor.contact }} <br>
            <div class="reviews" id="reviews-{{ doctor.id }}">
                <h4>Reviews:</h4>
                <ul class="reviews-list"></ul>
            </div>
            <button>
                <a href="{{ url_for('show_reviews', doctor_id=doctor.id) }}">View Reviews</a>
            </button>

            <button>
                <a href="{{ url_for('request_chat', doctor_id=doctor.id) }}">Request Session</a>
            </button>            
            

        </li>
        {% endfor %}
    </ul>

    <h2>Recommended Doctors</h2>
    <ul>
        {% for doctor in recommendations %}
        <li>
            <strong>Name:</strong> {{ doctor.name }} <br>
            <strong>Specialty:</strong> {{ doctor.specialty }} <br>
            <strong>Contact:</strong> {{ doctor.contact }}
        </li>
        {% endfor %}
    </ul>
    <!-- New Community Posts Section -->
    <h2>Recent Community Posts</h2>
    <ul>
        {% for post in recent_posts %}
        <li>
            <h3>{{ post.title }}</h3>
            <p>{{ post.content | truncate(100) }}</p>
            <small>Posted by {{ post.user.name }} on {{ post.date_posted }}</small><br>
            <a href="{{ url_for('view_post', post_id=post.id) }}">View Post</a>
        </li>
        {% endfor %}
    </ul>

    <a href="{{ url_for('community') }}">View All Community Posts</a>


    <a href="{{ url_for('logout') }}">Logout</a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.load-reviews-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    loadReviews(doctorId);
                });
            });
        });
    
        function loadReviews(doctorId) {
            fetch(`/api/reviews/${doctorId}`)
            .then(response => response.json())
            .then(data => {
                const reviewsList = document.getElementById(`reviews-${doctorId}`).querySelector('.reviews-list');
                reviewsList.innerHTML = '';
                data.reviews.forEach(review => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>${review.user}:</strong> ${review.rating} stars - ${review.comment}`;
                    reviewsList.appendChild(listItem);
                });
            });
        }
    </script>
    
</body>
</html>
